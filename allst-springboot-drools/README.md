# Drools
[Drools](https://www.drools.org/)
```text

```


## 《Drools规则引擎技术指南》
```text
1.1 程序来源于生活

◆ Drools是一个开源的规则引擎技术


1.2 Drools是什么

◆ Drools是开源的项目，是具有一定学习成本的规则引擎技术，通过Drools特定的语法，将固定的业务、经常变的业务统一管理。它以特定的文件或数据库方式将规则内容进行存储（存放在哪里都可以，可以理解为它只需一个存储介质），以Drools包提供的接口对规则内容进行处理，并返回公司运营所规定的业务结果，当然这个结果也是正确的


1.3 Drools简要概述

◆ Drools是一款基于Java语言的开源规则引擎，可以将复杂且多变的业务规则从硬编码中解放出来，以规则脚本的形式存放在文件或特定的存储介质中（这里可以是数据库表），使得业务规则的变更不需要修正项目代码、重启服务器就可以在线上环境立即生效。这里可以理解为动态代码（动态业务）

◆ 规则引擎的核心目的之一是将业务决策从程序代码中分离出来，使其代码与业务解耦合

◆ 通过特定的语法内容编写业务模块，由API进行解析并对外提供执行接口，再接收输入数据、进行业务逻辑处理并返回执行结果


1.4 Drools发展趋势

◆ Drools规则引擎是为开发人员提供的KRR功能程序，KRR是人工智能的核心，所以Drools也是人工智能的一个分支，是专家系统的另一种展现方式

◆ 2022/11/10发表想法

英语缩略词“KRR”经常作为“Kresge Reading Room”的缩写来使用，中文表示：“Kresge阅览室”

原文：KRR

◆ Drools的核心之一是操作业务，与传统项目不同的是，业务由业务操作员管理，不再需要程序员去改代码，极大地减少了开发周期，使得业务员不再依赖IT部门就可以完成业务的变更。正是因为规则引擎有这样的优势，所以受到了风险控制类、反欺诈类、促销类项目的青睐


1.6 Drools新特性

◆ 自6.0版本开始，Drools推出了一个全新的概念，基于KIE的全新API，其目的是为了更简单地操作规则引擎

◆ KIE(Knowledge Is Everything)是“知识是一切”的缩写，是Jboss一系列项目的总称

◆ KIE的主要模块有OptaPlanner、Drools、UberFire、jBPM


1.7 KIE生命周期

◆ 创建：通过KIE-WB创建知识库，如DRL、BPMN2、决策表、决策树、实体等

◆ 构建：构建一个可提供KIE部署的组件，简单地说，就是生成一个包含知识库的jar包，通过Java代码或KIE-WB提供的服务器（Kie-Server）来操作业务规则

◆ 测试：在构建部署前，对整体知识库进行测试。通常使用的测试场景将在4.1节中讲到

◆ 部署：KIE使用Maven将其组件部署到应用程序上

◆ 使用：通过KieContainer创建Kie会话（KieSession），为执行提供前提条件

◆ 执行：通过执行KieSession与Drools系统进行交互，执行规则、流程、决策表等

◆ 交互：用户与KieSession的交互，通过代码或页面进行操作

◆ 管理：管理KieSession、KieContainer等Drools提供的相关对象


1.8 为什么要用规则引擎

◆ 一般的项目中没有引用规则引擎之前，通常的做法都是使用一个接口进行业务工作。首先要传进去参数，通过if…else或其他方式进行业务逻辑判断，其次要获取到接口执行完毕后的结果。引用规则引擎后就截然不同了，原有的if…else不复存在，代替它们的是规则引擎脚本，通过规则引擎实现可动态变化的“if …else”


2.1 经典Hello World

◆ Drools规则引擎文件扩展名有很多种，最基本的是*.drl文件，也可以是*.xml[1]和*.drls文件，甚至还可以是*.xls或*.xlsx[2]文件

◆ hello.drl代码就是一个标准的规则文件。其中，package表示规则逻辑路径，rule表示规则开始，end表示规则结束，test001表示规则名，when表示规则条件，then表示规则返回结果。在关键字then中的代码是Java的打印语句。在规则引擎脚本中可以写Java代码，这是因为Drools是基于Java语言开发的

◆ 需要在资源目录中创建一个META-INF目录，并创建一个kmodule.xml配置文件

◆ 规则文件内容一般包含三大块，即包路径、引用、规则体。一个最简单的规则至少要包含包路径与规则体。规则文件还有一个重点，即规则文件名，接下来将对规则文件中的三大块及规则文件名进行阐述

◆ 规则文件名即hello.drl，其命名规则不像Java那样要求首字母大写。虽然要求并不严格，但对规则文件命名时也最好要规范，见名知意，既方便自己，又方便他人

◆ package。关键字package为三大块中的包路径，这里的包路径是逻辑路径，理论上是可以随便定义的，并且是必填内容。为了更方便地开发，建议读者在编辑包路径时最好与文件目录同名，类似Java一样以小数点（.）的方式隔开，且必须用小数点隔开。这里要提醒一下读者，在规则文件中关键字package永远在代码的第一行（规则模板除外）。

◆ rule。关键字rule为三大块中的规则体，是核心内容之一，以关键字rule开头，以end结尾，每个规则文件中可以包含多个rule规则体，但rule规则体之间不能交叉使用，即一个rule只能对应一个end

◆ import。关键字import为三大块中的引用，它与Java引用其他类是一样的，其目的是为了对象类引用。与Java不同的是，在引用静态方法时，需要添加function[5]关键字。

◆ 规则体是规则文件内容中的核心，分为LHS、RHS两大功能模块

◆ LHS。条件部分又被称为Left Hand Side(LHS)，即规则体when与then中间的部分

◆ RHS。结果部分又被称为Right Hand Side，即一个规则体中then与end之前的部分，只有LHS部分的条件都满足时RHS部分才会被执行

◆ RHS才是规则体真正做事情的部分，即要处理和返回业务结果的部分

◆ Drools规则引擎中传递的数据，术语称Fact对象[7]。Fact对象是一个普通的JavaBean（不只是JavaBean对象，也可以是任何Object对象），规则体中可以对当前对象进行任何的读/写操作，调用该对象提供的方法


2.2 对象引用

◆ 对象引用就是之前提到的import引用模块，是规则内容中非常重要的组成部分，即引入所需要的Java类或方法

◆ 图2-5　KieSession操作Fact对象的方法


2.3 Drools配置文件

◆ Drools的配置文件，主要配置文件有两个，即pom.xml与kmodule.xml，核心内容是kmodule.xml

◆ 通过pom.xml配置文件要用KIE操作统一管理规则，其中drools-compiler是必须引用的包。这个包的主要目的是对规则进行编译、构建等。

```